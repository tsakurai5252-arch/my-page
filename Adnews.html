<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å–¶ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›</title>
<style>
  body { font-family: sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
  .container { width: 100%; max-width: 600px; }
  /* æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆç®¡ç†è€…ç”¨ï¼‰ */
  .admin-panel { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
  input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
  .btn-send { background: #e67e22; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
  /* ãƒ‹ãƒ¥ãƒ¼ã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ */
  .news-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 5px solid #e67e22; }
  .news-meta { font-size: 0.8rem; color: #888; display: flex; justify-content: space-between; }
  .news-title { font-size: 1.2rem; font-weight: bold; margin: 10px 0; color: #333; }
  .news-content { white-space: pre-wrap; color: #555; line-height: 1.6; }
</style>
</head>
<body>

<div class="container">
  <div class="admin-panel" id="adminForm">
    <h3>ğŸ“¢ æ–°è¦ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿</h3>
    <input type="text" id="adminAuthor" placeholder="æ›´æ–°è€…å">
    <input type="text" id="adminTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
    <textarea id="adminContent" rows="4" placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
    <button class="btn-send" onclick="postNews()">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å…¬é–‹ã™ã‚‹</button>
  </div>

  <hr>

  <div id="newsDisplay">
    <p style="text-align: center; color: #888;">èª­ã¿è¾¼ã¿ä¸­...</p>
  </div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxy_csm6SjeGboSzae4wOfNgHBzHGh_ZC2u2ciGc678YhcMRe1A5Zio-upZDzJLFKZn/exec";
// ç°¡æ˜“èªè¨¼ç”¨ï¼šæœ¬æ¥ã¯IDç­‰ã§isValidRequestã‚’é€šã™
const ADMIN_ID = "ADMIN001"; 
const SECRET_SALT = "BLUE_SKY_77";

function genKey(id) {
  const d = new Date().toISOString().slice(0,10).replace(/-/g,"");
  return (id+d+SECRET_SALT).split("").reverse().join("");
}

// ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æŠ•ç¨¿ã™ã‚‹
async function postNews() {
  const author = document.getElementById("adminAuthor").value;
  const title = document.getElementById("adminTitle").value;
  const content = document.getElementById("adminContent").value;
  
  if(!author || !title || !content) return alert("å…¨é …ç›®å…¥åŠ›ã—ã¦ãã ã•ã„");

  const payload = {
    mode: "saveNews",
    id: ADMIN_ID,
    author: author,
    title: title,
    content: content,
    _v: genKey(ADMIN_ID)
  };

  try {
    const res = await fetch(WEBAPP_URL, { method: "POST", body: JSON.stringify(payload) });
    const data = await res.json();
    alert(data.message);
    location.reload(); // å†èª­ã¿è¾¼ã¿ã—ã¦åæ˜ 
  } catch(e) { alert("æŠ•ç¨¿å¤±æ•—"); }
}

// ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
async function loadNews() {
  try {
    const res = await fetch(`${WEBAPP_URL}?mode=getNews&id=${ADMIN_ID}&_v=${genKey(ADMIN_ID)}`);
    const newsList = await res.json();
    const display = document.getElementById("newsDisplay");
    display.innerHTML = "<h2>æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›</h2>";

    if (newsList.length === 0) {
      display.innerHTML += "<p>ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
      return;
    }

    newsList.forEach(item => {
      display.innerHTML += `
        <div class="news-card">
          <div class="news-meta">
            <span>ğŸ“… ${item.date}</span>
            <span>âœï¸ ${item.author}</span>
          </div>
          <div class="news-title">${item.title}</div>
          <div class="news-content">${item.content}</div>
        </div>
      `;
    });
  } catch(e) { 
    document.getElementById("newsDisplay").innerHTML = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
  }
}

// èµ·å‹•æ™‚ã«ãƒ‹ãƒ¥ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
loadNews();
</script>
</body>
</html>